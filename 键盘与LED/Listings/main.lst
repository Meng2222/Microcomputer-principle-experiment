C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 19:38:01 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "HD7279.h"
   2          #include "delay.h"
   3          #include "main.h"
   4          #include "basicIO.h"
   5          
   6          typedef enum
   7          {
   8                  rollingLeft,
   9                  rollingRight,
  10                  showKeyNumTogether,
  11                  inputRoll2Left,
  12                  idle
  13          }ledStatus_t;
  14          
  15          typedef enum
  16          {
  17                  keyLed,
  18                  basicIO,
  19                  statusIdle
  20          }status_t;
  21          
  22          void main(void)
  23          {
  24   1      #define ROLL_PERIOD (15)
  25   1              ledStatus_t ledStatus = inputRoll2Left;
  26   1              status_t status = basicIO;
  27   1              unsigned char i,j = 0;
  28   1              unsigned char keyState = 0;
  29   1              unsigned char rollPeriod = ROLL_PERIOD;
  30   1              unsigned char keyFlag = 0;
  31   1              unsigned char ioInput = 0;
  32   1              P1 = 0x00;
  33   1              
  34   1              DelayMs(25);
  35   1              
  36   1      //      for(j = 0 ; j < 10 ; j++)
  37   1      //      {
  38   1      //      for(i = 0 ; i < 8 ; i++)
  39   1      //      {
  40   1      //              LedWrite(0x97 - i, realCode[8 - i]);
  41   1      //      }
  42   1      //      DelayMs(250);
  43   1      //      }
  44   1              while(1)
  45   1              {
  46   2                      DelayMs(20);
  47   2                      
  48   2                      switch(status)
  49   2                      {
  50   3                              case keyLed:
  51   3                                      keyState = KeyRead();
  52   3      
  53   3                                      switch(ledStatus)
  54   3                                      {
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 19:38:01 PAGE 2   

  55   4                                              case rollingLeft:
  56   4                                                      if(keyState==0xff)
  57   4                                                      {
  58   5                                                              rollPeriod--;
  59   5                                                              if(rollPeriod == 0)
  60   5                                                              {
  61   6                                                                      rollPeriod = ROLL_PERIOD;
  62   6                                                                      HD7279SendByte(RTL_CYCLE);
  63   6                                                              }
  64   5                                                      }
  65   4                                                      else if(keyState == KEY10)
  66   4                                                      {
  67   5                                                              rollPeriod = ROLL_PERIOD;
  68   5                                                              HD7279SendByte(CMD_RESET);
  69   5                                                              ledStatus = showKeyNumTogether;
  70   5                                                      }
  71   4                                              break;
  72   4                                              case rollingRight:
  73   4                                                      if(keyState == 0xff)
  74   4                                                      {
  75   5                                                              rollPeriod--;
  76   5                                                              if(rollPeriod == 0)
  77   5                                                              {
  78   6                                                                      rollPeriod = ROLL_PERIOD;
  79   6                                                                      HD7279SendByte(RTR_CYCLE);
  80   6                                                              }
  81   5                                                      }
  82   4                                                      else if(keyState == KEY10)
  83   4                                                      {
  84   5                                                              rollPeriod = ROLL_PERIOD;
  85   5                                                              HD7279SendByte(CMD_RESET);
  86   5                                                              ledStatus = showKeyNumTogether;                         
  87   5                                                      }
  88   4                                              break;
  89   4                                              case showKeyNumTogether:
  90   4                                                      switch(keyState)
  91   4                                                      {
  92   5                                                              case KEY0:
  93   5                                                                      for(i = 0 ; i < 8 ; i++)
  94   5                                                                      {
  95   6                                                                              LedWrite(0x97 - i, realCode[0]);
  96   6                                                                      }
  97   5                                                              break;
  98   5                                                              case KEY1:
  99   5                                                                      for(i = 0 ; i < 8 ; i++)
 100   5                                                                      {
 101   6                                                                              LedWrite(0x97 - i, realCode[1]);
 102   6                                                                      }
 103   5                                                              break;
 104   5                                                              case KEY2:
 105   5                                                                      for(i = 0 ; i < 8 ; i++)
 106   5                                                                      {
 107   6                                                                              LedWrite(0x97 - i, realCode[2]);
 108   6                                                                      }
 109   5                                                              break;
 110   5                                                              case KEY3:
 111   5                                                                      for(i = 0 ; i < 8 ; i++)
 112   5                                                                      {
 113   6                                                                              LedWrite(0x97 - i, realCode[3]);
 114   6                                                                      }
 115   5                                                              break;
 116   5                                                              case KEY4:
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 19:38:01 PAGE 3   

 117   5                                                                      for(i = 0 ; i < 8 ; i++)
 118   5                                                                      {
 119   6                                                                              LedWrite(0x97 - i, realCode[4]);
 120   6                                                                      }                                       
 121   5                                                              break;
 122   5                                                              case KEY5:
 123   5                                                                      for(i = 0 ; i < 8 ; i++)
 124   5                                                                      {
 125   6                                                                              LedWrite(0x97 - i, realCode[5]);
 126   6                                                                      }                                       
 127   5                                                              break;
 128   5                                                              case KEY6:
 129   5                                                                      for(i = 0 ; i < 8 ; i++)
 130   5                                                                      {
 131   6                                                                              LedWrite(0x97 - i, realCode[6]);
 132   6                                                                      }                                       
 133   5                                                              break;
 134   5                                                              case KEY7:
 135   5                                                                      for(i = 0 ; i < 8 ; i++)
 136   5                                                                      {
 137   6                                                                              LedWrite(0x97 - i, realCode[7]);
 138   6                                                                      }                                       
 139   5                                                              break;
 140   5                                                              case KEY8:
 141   5                                                                      for(i = 0 ; i < 8 ; i++)
 142   5                                                                      {
 143   6                                                                              LedWrite(0x97 - i, realCode[8]);
 144   6                                                                      }                                       
 145   5                                                              break;
 146   5                                                              case KEY9:
 147   5                                                                      for(i = 0 ; i < 8 ; i++)
 148   5                                                                      {
 149   6                                                                              LedWrite(0x97 - i, realCode[9]);
 150   6                                                                      }                                       
 151   5                                                              break;
 152   5                                                              default:
 153   5                                                              break;
 154   5                                                      }       
 155   4                                              break;
 156   4                                              case inputRoll2Left:
 157   4                                                      if(keyState!=0xff&&keyFlag==0)
 158   4                                                      {
 159   5                                                              HD7279SendByte(RTL_UNCYL);
 160   5                                                              switch(keyState)
 161   5                                                              {
 162   6                                                                      case KEY0:
 163   6                                                                              LedWrite(LED1, realCode[0]);
 164   6                                                                      break;
 165   6                                                                      case KEY1:
 166   6                                                                              LedWrite(LED1, realCode[1]);
 167   6                                                                      break;
 168   6                                                                      case KEY2:
 169   6                                                                              LedWrite(LED1, realCode[2]);
 170   6                                                                      break;
 171   6                                                                      case KEY3:
 172   6                                                                              LedWrite(LED1, realCode[3]);
 173   6                                                                      break;
 174   6                                                                      case KEY4:
 175   6                                                                              LedWrite(LED1, realCode[4]);
 176   6                                                                      break;
 177   6                                                                      case KEY5:
 178   6                                                                              LedWrite(LED1, realCode[5]);
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 19:38:01 PAGE 4   

 179   6                                                                      break;
 180   6                                                                      case KEY6:
 181   6                                                                              LedWrite(LED1, realCode[6]);
 182   6                                                                      break;
 183   6                                                                      case KEY7:
 184   6                                                                              LedWrite(LED1, realCode[7]);
 185   6                                                                      break;
 186   6                                                                      case KEY8:
 187   6                                                                              LedWrite(LED1, realCode[8]);
 188   6                                                                      break;
 189   6                                                                      case KEY9:
 190   6                                                                              LedWrite(LED1, realCode[9]);
 191   6                                                                      break;
 192   6                                                                      default:
 193   6                                                                      break;
 194   6                                                              }
 195   5                                                              keyFlag = 1;
 196   5                                                      }
 197   4                                                      if(keyState == 0xff&&keyFlag == 1)
 198   4                                                      {
 199   5                                                              keyFlag = 0;
 200   5                                                      }
 201   4                                                              
 202   4                                              break;
 203   4                                              case idle:
 204   4                                              break;
 205   4                                              default:
 206   4                                              break;
 207   4                                      }
 208   3                              break;
 209   3                              case basicIO:
 210   3                                      ioInput = chip245Adress;
 211   3                                      chip374Adress = ~ioInput;
 212   3                                      for(i = 0 ; i < 8 ; i++)
 213   3                                      {
 214   4                                              if((ioInput>>i)&0x01)
 215   4                                              {
 216   5                                                      LedWrite(0x97 - 7 + i, realCode[1]);
 217   5                                              }
 218   4                                              else
 219   4                                              {
 220   5                                                      LedWrite(0x97 - 7 + i, realCode[0]);                                    
 221   5                                              }
 222   4                                      }
 223   3                                      
 224   3                              break;
 225   3                              case statusIdle:
 226   3                              break;
 227   3                              default:
 228   3                              break;
 229   3                      }
 230   2                      
 231   2      
 232   2              }
 233   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    689    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 19:38:01 PAGE 5   

   DATA SIZE        =   ----       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
