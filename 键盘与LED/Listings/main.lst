C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:55:47 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "HD7279.h"
   2          #include "delay.h"
   3          #include "main.h"
   4          #include "basicIO.h"
   5          #include "decode.h"
   6          
   7          //数码管显示状态枚举变量
   8          typedef enum
   9          {
  10                  rollingLeft,
  11                  rollingRight,
  12                  showKeyNumTogether,
  13                  inputRoll2Left,
  14                  idle
  15          }ledStatus_t;
  16          
  17          //程序运行状态枚举变量
  18          typedef enum
  19          {
  20                  keyLed,
  21                  basicIO,
  22                  decode,
  23                  statusIdle
  24          }status_t;
  25          
  26          void main(void)
  27          {
  28   1      //数码管滚动显示的周期
  29   1      #define ROLL_PERIOD (15)
  30   1              ledStatus_t ledStatus = inputRoll2Left;
  31   1              status_t status = basicIO;
  32   1              unsigned char i,j = 0;
  33   1              //按键状态，没有按下时为0xff，按下时为按下按键的编号
  34   1              unsigned char keyState = 0;
  35   1              unsigned char rollPeriod = ROLL_PERIOD;
  36   1              //按键是否按下标志位
  37   1              unsigned char keyFlag = 0;
  38   1              //简单IO输入值
  39   1              unsigned char ioInput = 0;
  40   1              //译码实验输出用变量
  41   1              unsigned char ioOutput = 0;
  42   1              //译码实验闪烁计时变量
  43   1              unsigned short timeCounter = 0;
  44   1              
  45   1              //将HD7279对应引脚全部拉低
  46   1              P1 = 0x00;
  47   1              
  48   1              DelayMs(25);
  49   1              
  50   1      //      for(j = 0 ; j < 10 ; j++)
  51   1      //      {
  52   1      //      for(i = 0 ; i < 8 ; i++)
  53   1      //      {
  54   1      //              LedWrite(0x97 - i, realCode[8 - i]);
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:55:47 PAGE 2   

  55   1      //      }
  56   1      //      DelayMs(250);
  57   1      //      }
  58   1              while(1)
  59   1              {
  60   2                      DelayMs(20);
  61   2                      
  62   2                      switch(status)
  63   2                      {
  64   3                              //按键和LED
  65   3                              case keyLed:
  66   3                                      
  67   3                                      //读取按键状态
  68   3                                      keyState = KeyRead();
  69   3      
  70   3                                      switch(ledStatus)
  71   3                                      {
  72   4                                              //向左滚动
  73   4                                              case rollingLeft:
  74   4                                                      //没有按键按下时循环向左滚动
  75   4                                                      if(keyState==0xff)
  76   4                                                      {
  77   5                                                              rollPeriod--;
  78   5                                                              if(rollPeriod == 0)
  79   5                                                              {
  80   6                                                                      rollPeriod = ROLL_PERIOD;
  81   6                                                                      HD7279SendByte(RTL_CYCLE);
  82   6                                                              }
  83   5                                                      }
  84   4                                                      //按下KEY10后进入一同显示数字状态
  85   4                                                      else if(keyState == KEY10)
  86   4                                                      {
  87   5                                                              rollPeriod = ROLL_PERIOD;
  88   5                                                              HD7279SendByte(CMD_RESET);
  89   5                                                              ledStatus = showKeyNumTogether;
  90   5                                                      }
  91   4                                              break;
  92   4                                              //循环向右滚动
  93   4                                              case rollingRight:
  94   4                                                      //没有按键按下时循环向右滚动
  95   4                                                      if(keyState == 0xff)
  96   4                                                      {
  97   5                                                              rollPeriod--;
  98   5                                                              if(rollPeriod == 0)
  99   5                                                              {
 100   6                                                                      rollPeriod = ROLL_PERIOD;
 101   6                                                                      HD7279SendByte(RTR_CYCLE);
 102   6                                                              }
 103   5                                                      }
 104   4                                                      //按下KEY10时进入一同显示按下数字状态
 105   4                                                      else if(keyState == KEY10)
 106   4                                                      {
 107   5                                                              rollPeriod = ROLL_PERIOD;
 108   5                                                              HD7279SendByte(CMD_RESET);
 109   5                                                              ledStatus = showKeyNumTogether;                         
 110   5                                                      }
 111   4                                              break;
 112   4                                              //所有数码管一同显示按下按键对应数字
 113   4                                              case showKeyNumTogether:
 114   4                                                      switch(keyState)
 115   4                                                      {
 116   5                                                              case KEY0:
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:55:47 PAGE 3   

 117   5                                                                      for(i = 0 ; i < 8 ; i++)
 118   5                                                                      {
 119   6                                                                              LedWrite(0x97 - i, realCode[0]);
 120   6                                                                      }
 121   5                                                              break;
 122   5                                                              case KEY1:
 123   5                                                                      for(i = 0 ; i < 8 ; i++)
 124   5                                                                      {
 125   6                                                                              LedWrite(0x97 - i, realCode[1]);
 126   6                                                                      }
 127   5                                                              break;
 128   5                                                              case KEY2:
 129   5                                                                      for(i = 0 ; i < 8 ; i++)
 130   5                                                                      {
 131   6                                                                              LedWrite(0x97 - i, realCode[2]);
 132   6                                                                      }
 133   5                                                              break;
 134   5                                                              case KEY3:
 135   5                                                                      for(i = 0 ; i < 8 ; i++)
 136   5                                                                      {
 137   6                                                                              LedWrite(0x97 - i, realCode[3]);
 138   6                                                                      }
 139   5                                                              break;
 140   5                                                              case KEY4:
 141   5                                                                      for(i = 0 ; i < 8 ; i++)
 142   5                                                                      {
 143   6                                                                              LedWrite(0x97 - i, realCode[4]);
 144   6                                                                      }                                       
 145   5                                                              break;
 146   5                                                              case KEY5:
 147   5                                                                      for(i = 0 ; i < 8 ; i++)
 148   5                                                                      {
 149   6                                                                              LedWrite(0x97 - i, realCode[5]);
 150   6                                                                      }                                       
 151   5                                                              break;
 152   5                                                              case KEY6:
 153   5                                                                      for(i = 0 ; i < 8 ; i++)
 154   5                                                                      {
 155   6                                                                              LedWrite(0x97 - i, realCode[6]);
 156   6                                                                      }                                       
 157   5                                                              break;
 158   5                                                              case KEY7:
 159   5                                                                      for(i = 0 ; i < 8 ; i++)
 160   5                                                                      {
 161   6                                                                              LedWrite(0x97 - i, realCode[7]);
 162   6                                                                      }                                       
 163   5                                                              break;
 164   5                                                              case KEY8:
 165   5                                                                      for(i = 0 ; i < 8 ; i++)
 166   5                                                                      {
 167   6                                                                              LedWrite(0x97 - i, realCode[8]);
 168   6                                                                      }                                       
 169   5                                                              break;
 170   5                                                              case KEY9:
 171   5                                                                      for(i = 0 ; i < 8 ; i++)
 172   5                                                                      {
 173   6                                                                              LedWrite(0x97 - i, realCode[9]);
 174   6                                                                      }                                       
 175   5                                                              break;
 176   5                                                              default:
 177   5                                                              break;
 178   5                                                      }       
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:55:47 PAGE 4   

 179   4                                              break;
 180   4                                                      //每次按键时不循环左移并显示按键对应的数字
 181   4                                              case inputRoll2Left:
 182   4                                                      if(keyState!=0xff&&keyFlag==0)
 183   4                                                      {
 184   5                                                              HD7279SendByte(RTL_UNCYL);
 185   5                                                              switch(keyState)
 186   5                                                              {
 187   6                                                                      case KEY0:
 188   6                                                                              LedWrite(LED1, realCode[0]);
 189   6                                                                      break;
 190   6                                                                      case KEY1:
 191   6                                                                              LedWrite(LED1, realCode[1]);
 192   6                                                                      break;
 193   6                                                                      case KEY2:
 194   6                                                                              LedWrite(LED1, realCode[2]);
 195   6                                                                      break;
 196   6                                                                      case KEY3:
 197   6                                                                              LedWrite(LED1, realCode[3]);
 198   6                                                                      break;
 199   6                                                                      case KEY4:
 200   6                                                                              LedWrite(LED1, realCode[4]);
 201   6                                                                      break;
 202   6                                                                      case KEY5:
 203   6                                                                              LedWrite(LED1, realCode[5]);
 204   6                                                                      break;
 205   6                                                                      case KEY6:
 206   6                                                                              LedWrite(LED1, realCode[6]);
 207   6                                                                      break;
 208   6                                                                      case KEY7:
 209   6                                                                              LedWrite(LED1, realCode[7]);
 210   6                                                                      break;
 211   6                                                                      case KEY8:
 212   6                                                                              LedWrite(LED1, realCode[8]);
 213   6                                                                      break;
 214   6                                                                      case KEY9:
 215   6                                                                              LedWrite(LED1, realCode[9]);
 216   6                                                                      break;
 217   6                                                                      default:
 218   6                                                                      break;
 219   6                                                              }
 220   5                                                              keyFlag = 1;
 221   5                                                      }
 222   4                                                      if(keyState == 0xff&&keyFlag == 1)
 223   4                                                      {
 224   5                                                              keyFlag = 0;
 225   5                                                      }
 226   4                                                              
 227   4                                              break;
 228   4                                              //空闲状态
 229   4                                              case idle:
 230   4                                              break;
 231   4                                              default:
 232   4                                              break;
 233   4                                      }
 234   3                              break;
 235   3                              //简单IO实验
 236   3                              case basicIO:
 237   3                                      
 238   3                                      //从74LS245地址读取简单IO输入
 239   3                                      ioInput = chip245Adress;
 240   3                              
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:55:47 PAGE 5   

 241   3                                      //将简单IO输入输出到74LS374
 242   3                                      chip374Adress = ~ioInput;
 243   3                              
 244   3                                      //在数码管上显示简单IO输入状态
 245   3                                      for(i = 0 ; i < 8 ; i++)
 246   3                                      {
 247   4                                              if((ioInput>>i)&0x01)
 248   4                                              {
 249   5                                                      LedWrite(0x97 - 7 + i, realCode[1]);
 250   5                                              }
 251   4                                              else
 252   4                                              {
 253   5                                                      LedWrite(0x97 - 7 + i, realCode[0]);
 254   5                                              }
 255   4                                      }
 256   3                                      
 257   3                              break;
 258   3                              //译码器实验
 259   3                              case decode:
 260   3                                      timeCounter++;
 261   3                                      timeCounter%=20;
 262   3                                      if(timeCounter/10)
 263   3                                      {
 264   4                                              decodeAdress1 = ioOutput;
 265   4                                      }
 266   3                                      else
 267   3                                      {
 268   4                                              decodeAdress2 = ioOutput;
 269   4                                      }
 270   3                              
 271   3                              break;
 272   3                              case statusIdle:
 273   3                              break;
 274   3                              default:
 275   3                              break;
 276   3                      }
 277   2                      
 278   2      
 279   2              }
 280   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    760    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
