C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:09:08 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "HD7279.h"
   2          #include "delay.h"
   3          #include "main.h"
   4          #include "basicIO.h"
   5          #include "decode.h"
   6          
   7          typedef enum
   8          {
   9                  rollingLeft,
  10                  rollingRight,
  11                  showKeyNumTogether,
  12                  inputRoll2Left,
  13                  idle
  14          }ledStatus_t;
  15          
  16          typedef enum
  17          {
  18                  keyLed,
  19                  basicIO,
  20                  decode,
  21                  statusIdle
  22          }status_t;
  23          
  24          void main(void)
  25          {
  26   1      #define ROLL_PERIOD (15)
  27   1              ledStatus_t ledStatus = inputRoll2Left;
  28   1              status_t status = decode;
  29   1              unsigned char i,j = 0;
  30   1              unsigned char keyState = 0;
  31   1              unsigned char rollPeriod = ROLL_PERIOD;
  32   1              unsigned char keyFlag = 0;
  33   1              unsigned char ioInput = 0;
  34   1              unsigned char ioOutput = 0;
  35   1              unsigned short timeCounter = 0;
  36   1              P1 = 0x00;
  37   1              
  38   1              DelayMs(25);
  39   1              
  40   1      //      for(j = 0 ; j < 10 ; j++)
  41   1      //      {
  42   1      //      for(i = 0 ; i < 8 ; i++)
  43   1      //      {
  44   1      //              LedWrite(0x97 - i, realCode[8 - i]);
  45   1      //      }
  46   1      //      DelayMs(250);
  47   1      //      }
  48   1              while(1)
  49   1              {
  50   2                      DelayMs(20);
  51   2                      
  52   2                      switch(status)
  53   2                      {
  54   3                              case keyLed:
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:09:08 PAGE 2   

  55   3                                      keyState = KeyRead();
  56   3      
  57   3                                      switch(ledStatus)
  58   3                                      {
  59   4                                              case rollingLeft:
  60   4                                                      if(keyState==0xff)
  61   4                                                      {
  62   5                                                              rollPeriod--;
  63   5                                                              if(rollPeriod == 0)
  64   5                                                              {
  65   6                                                                      rollPeriod = ROLL_PERIOD;
  66   6                                                                      HD7279SendByte(RTL_CYCLE);
  67   6                                                              }
  68   5                                                      }
  69   4                                                      else if(keyState == KEY10)
  70   4                                                      {
  71   5                                                              rollPeriod = ROLL_PERIOD;
  72   5                                                              HD7279SendByte(CMD_RESET);
  73   5                                                              ledStatus = showKeyNumTogether;
  74   5                                                      }
  75   4                                              break;
  76   4                                              case rollingRight:
  77   4                                                      if(keyState == 0xff)
  78   4                                                      {
  79   5                                                              rollPeriod--;
  80   5                                                              if(rollPeriod == 0)
  81   5                                                              {
  82   6                                                                      rollPeriod = ROLL_PERIOD;
  83   6                                                                      HD7279SendByte(RTR_CYCLE);
  84   6                                                              }
  85   5                                                      }
  86   4                                                      else if(keyState == KEY10)
  87   4                                                      {
  88   5                                                              rollPeriod = ROLL_PERIOD;
  89   5                                                              HD7279SendByte(CMD_RESET);
  90   5                                                              ledStatus = showKeyNumTogether;                         
  91   5                                                      }
  92   4                                              break;
  93   4                                              case showKeyNumTogether:
  94   4                                                      switch(keyState)
  95   4                                                      {
  96   5                                                              case KEY0:
  97   5                                                                      for(i = 0 ; i < 8 ; i++)
  98   5                                                                      {
  99   6                                                                              LedWrite(0x97 - i, realCode[0]);
 100   6                                                                      }
 101   5                                                              break;
 102   5                                                              case KEY1:
 103   5                                                                      for(i = 0 ; i < 8 ; i++)
 104   5                                                                      {
 105   6                                                                              LedWrite(0x97 - i, realCode[1]);
 106   6                                                                      }
 107   5                                                              break;
 108   5                                                              case KEY2:
 109   5                                                                      for(i = 0 ; i < 8 ; i++)
 110   5                                                                      {
 111   6                                                                              LedWrite(0x97 - i, realCode[2]);
 112   6                                                                      }
 113   5                                                              break;
 114   5                                                              case KEY3:
 115   5                                                                      for(i = 0 ; i < 8 ; i++)
 116   5                                                                      {
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:09:08 PAGE 3   

 117   6                                                                              LedWrite(0x97 - i, realCode[3]);
 118   6                                                                      }
 119   5                                                              break;
 120   5                                                              case KEY4:
 121   5                                                                      for(i = 0 ; i < 8 ; i++)
 122   5                                                                      {
 123   6                                                                              LedWrite(0x97 - i, realCode[4]);
 124   6                                                                      }                                       
 125   5                                                              break;
 126   5                                                              case KEY5:
 127   5                                                                      for(i = 0 ; i < 8 ; i++)
 128   5                                                                      {
 129   6                                                                              LedWrite(0x97 - i, realCode[5]);
 130   6                                                                      }                                       
 131   5                                                              break;
 132   5                                                              case KEY6:
 133   5                                                                      for(i = 0 ; i < 8 ; i++)
 134   5                                                                      {
 135   6                                                                              LedWrite(0x97 - i, realCode[6]);
 136   6                                                                      }                                       
 137   5                                                              break;
 138   5                                                              case KEY7:
 139   5                                                                      for(i = 0 ; i < 8 ; i++)
 140   5                                                                      {
 141   6                                                                              LedWrite(0x97 - i, realCode[7]);
 142   6                                                                      }                                       
 143   5                                                              break;
 144   5                                                              case KEY8:
 145   5                                                                      for(i = 0 ; i < 8 ; i++)
 146   5                                                                      {
 147   6                                                                              LedWrite(0x97 - i, realCode[8]);
 148   6                                                                      }                                       
 149   5                                                              break;
 150   5                                                              case KEY9:
 151   5                                                                      for(i = 0 ; i < 8 ; i++)
 152   5                                                                      {
 153   6                                                                              LedWrite(0x97 - i, realCode[9]);
 154   6                                                                      }                                       
 155   5                                                              break;
 156   5                                                              default:
 157   5                                                              break;
 158   5                                                      }       
 159   4                                              break;
 160   4                                              case inputRoll2Left:
 161   4                                                      if(keyState!=0xff&&keyFlag==0)
 162   4                                                      {
 163   5                                                              HD7279SendByte(RTL_UNCYL);
 164   5                                                              switch(keyState)
 165   5                                                              {
 166   6                                                                      case KEY0:
 167   6                                                                              LedWrite(LED1, realCode[0]);
 168   6                                                                      break;
 169   6                                                                      case KEY1:
 170   6                                                                              LedWrite(LED1, realCode[1]);
 171   6                                                                      break;
 172   6                                                                      case KEY2:
 173   6                                                                              LedWrite(LED1, realCode[2]);
 174   6                                                                      break;
 175   6                                                                      case KEY3:
 176   6                                                                              LedWrite(LED1, realCode[3]);
 177   6                                                                      break;
 178   6                                                                      case KEY4:
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:09:08 PAGE 4   

 179   6                                                                              LedWrite(LED1, realCode[4]);
 180   6                                                                      break;
 181   6                                                                      case KEY5:
 182   6                                                                              LedWrite(LED1, realCode[5]);
 183   6                                                                      break;
 184   6                                                                      case KEY6:
 185   6                                                                              LedWrite(LED1, realCode[6]);
 186   6                                                                      break;
 187   6                                                                      case KEY7:
 188   6                                                                              LedWrite(LED1, realCode[7]);
 189   6                                                                      break;
 190   6                                                                      case KEY8:
 191   6                                                                              LedWrite(LED1, realCode[8]);
 192   6                                                                      break;
 193   6                                                                      case KEY9:
 194   6                                                                              LedWrite(LED1, realCode[9]);
 195   6                                                                      break;
 196   6                                                                      default:
 197   6                                                                      break;
 198   6                                                              }
 199   5                                                              keyFlag = 1;
 200   5                                                      }
 201   4                                                      if(keyState == 0xff&&keyFlag == 1)
 202   4                                                      {
 203   5                                                              keyFlag = 0;
 204   5                                                      }
 205   4                                                              
 206   4                                              break;
 207   4                                              case idle:
 208   4                                              break;
 209   4                                              default:
 210   4                                              break;
 211   4                                      }
 212   3                              break;
 213   3                              case basicIO:
 214   3                                      ioInput = chip245Adress;
 215   3                                      chip374Adress = ~ioInput;
 216   3                                      for(i = 0 ; i < 8 ; i++)
 217   3                                      {
 218   4                                              if((ioInput>>i)&0x01)
 219   4                                              {
 220   5                                                      LedWrite(0x97 - 7 + i, realCode[1]);
 221   5                                              }
 222   4                                              else
 223   4                                              {
 224   5                                                      LedWrite(0x97 - 7 + i, realCode[0]);                                    
 225   5                                              }
 226   4                                      }
 227   3                                      
 228   3                              break;
 229   3                              case decode:
 230   3                                      timeCounter++;
 231   3                                      timeCounter%=20;
 232   3                                      if(timeCounter/10)
 233   3                                      {
 234   4                                              decodeAdress1 = ioOutput;
 235   4                                      }
 236   3                                      else
 237   3                                      {
 238   4                                              decodeAdress2 = ioOutput;
 239   4                                      }
 240   3                              
C51 COMPILER V9.56.0.0   MAIN                                                              09/11/2017 20:09:08 PAGE 5   

 241   3                              break;
 242   3                              case statusIdle:
 243   3                              break;
 244   3                              default:
 245   3                              break;
 246   3                      }
 247   2                      
 248   2      
 249   2              }
 250   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    760    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
